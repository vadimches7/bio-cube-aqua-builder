import { Fish, AquariumType } from '@/types/aquarium';
import { CONVERTED_FISH_DATABASE } from './loadFishData';
import { updateFishIncompatibility } from '@/utils/compatibilityMatrix';

// Базовый список вручную прописанных видов (сохраняем их описания)
const BASE_FISH_DATABASE: Fish[] = [
  {
    id: 'neon-tetra',
    name: 'Неон',
    nameEn: 'Neon Tetra',
    image: '/fish/neon-tetra.jpg',
    minVolume: 30,
    maxCount: 20,
    zone: 'middle',
    temperament: 'peaceful',
    schooling: true,
    minSchoolSize: 6,
    difficulty: 'beginner',
    compatibleTypes: ['freshwater', 'planted'],
    incompatibleWith: ['oscar', 'arowana', 'piranha'],
    description: 'Яркая стайная рыбка с неоновой полосой. Идеальна для начинающих.',
    careLevel: 'Лёгкий',
  },
  {
    id: 'guppy',
    name: 'Гуппи',
    nameEn: 'Guppy',
    image: '/fish/guppy.jpg',
    minVolume: 20,
    maxCount: 15,
    zone: 'top',
    temperament: 'peaceful',
    schooling: false,
    difficulty: 'beginner',
    compatibleTypes: ['freshwater', 'planted'],
    incompatibleWith: ['betta', 'cichlid'],
    description: 'Неприхотливая живородящая рыбка с яркими хвостами.',
    careLevel: 'Очень лёгкий',
  },
  {
    id: 'angelfish',
    name: 'Скалярия',
    nameEn: 'Angelfish',
    image: '/fish/angelfish.jpg',
    minVolume: 100,
    maxCount: 6,
    zone: 'middle',
    temperament: 'semi-aggressive',
    schooling: false,
    difficulty: 'intermediate',
    compatibleTypes: ['freshwater', 'planted'],
    incompatibleWith: ['neon-tetra', 'guppy', 'shrimp'],
    description: 'Элегантная рыба с высоким плавником. Царственный вид.',
    careLevel: 'Средний',
  },
  {
    id: 'corydoras',
    name: 'Коридорас',
    nameEn: 'Corydoras',
    image: '/fish/corydoras.jpg',
    minVolume: 40,
    maxCount: 10,
    zone: 'bottom',
    temperament: 'peaceful',
    schooling: true,
    minSchoolSize: 4,
    difficulty: 'beginner',
    compatibleTypes: ['freshwater', 'planted'],
    incompatibleWith: [],
    description: 'Донный санитар. Очищает грунт от остатков корма.',
    careLevel: 'Лёгкий',
  },
  {
    id: 'betta',
    name: 'Петушок',
    nameEn: 'Betta',
    image: '/fish/betta.jpg',
    minVolume: 15,
    maxCount: 1,
    zone: 'top',
    temperament: 'aggressive',
    schooling: false,
    difficulty: 'beginner',
    compatibleTypes: ['freshwater'],
    incompatibleWith: ['guppy', 'betta'],
    description: 'Яркий и харизматичный. Содержится поодиночке.',
    careLevel: 'Лёгкий',
  },
  {
    id: 'discus',
    name: 'Дискус',
    nameEn: 'Discus',
    image: '/fish/discus.jpg',
    minVolume: 200,
    maxCount: 8,
    zone: 'middle',
    temperament: 'peaceful',
    schooling: true,
    minSchoolSize: 5,
    difficulty: 'advanced',
    compatibleTypes: ['freshwater', 'planted'],
    incompatibleWith: ['cichlid', 'aggressive'],
    description: 'Король аквариума. Требует идеальных условий.',
    careLevel: 'Сложный',
  },
  {
    id: 'cherry-shrimp',
    name: 'Креветка Вишня',
    nameEn: 'Cherry Shrimp',
    image: '/fish/cherry-shrimp.jpg',
    minVolume: 10,
    maxCount: 50,
    zone: 'bottom',
    temperament: 'peaceful',
    schooling: true,
    minSchoolSize: 10,
    difficulty: 'beginner',
    compatibleTypes: ['shrimp', 'planted'],
    incompatibleWith: ['angelfish', 'betta', 'cichlid'],
    description: 'Яркие красные креветки. Отличные санитары.',
    careLevel: 'Лёгкий',
  },
  {
    id: 'amano-shrimp',
    name: 'Креветка Амано',
    nameEn: 'Amano Shrimp',
    image: '/fish/amano.jpg',
    minVolume: 20,
    maxCount: 20,
    zone: 'bottom',
    temperament: 'peaceful',
    schooling: true,
    minSchoolSize: 5,
    difficulty: 'intermediate',
    compatibleTypes: ['shrimp', 'planted'],
    incompatibleWith: ['cichlid'],
    description: 'Лучшие уничтожители водорослей.',
    careLevel: 'Средний',
  },
  {
    id: 'malawi-cichlid',
    name: 'Цихлида Малави',
    nameEn: 'Malawi Cichlid',
    image: '/fish/malawi.jpg',
    minVolume: 150,
    maxCount: 15,
    zone: 'all',
    temperament: 'aggressive',
    schooling: false,
    difficulty: 'intermediate',
    compatibleTypes: ['cichlid', 'pseudomarine'],
    incompatibleWith: ['shrimp', 'peaceful'],
    description: 'Яркие африканские цихлиды. Активные и территориальные.',
    careLevel: 'Средний',
  },
  {
    id: 'pleco',
    name: 'Плекостомус',
    nameEn: 'Pleco',
    image: '/fish/pleco.jpg',
    minVolume: 150,
    maxCount: 2,
    zone: 'bottom',
    temperament: 'peaceful',
    schooling: false,
    difficulty: 'intermediate',
    compatibleTypes: ['freshwater', 'planted', 'cichlid'],
    incompatibleWith: [],
    description: 'Крупный сом-санитар. Чистит стёкла от водорослей.',
    careLevel: 'Средний',
  },
  {
    id: 'clownfish',
    name: 'Рыба-клоун',
    nameEn: 'Clownfish',
    image: '/fish/clownfish.jpg',
    minVolume: 100,
    maxCount: 2,
    zone: 'middle',
    temperament: 'semi-aggressive',
    schooling: false,
    difficulty: 'advanced',
    compatibleTypes: ['marine'],
    incompatibleWith: [],
    description: 'Культовая морская рыба. Живёт в симбиозе с актиниями.',
    careLevel: 'Сложный',
  },
  {
    id: 'tang',
    name: 'Хирург',
    nameEn: 'Tang',
    image: '/fish/tang.jpg',
    minVolume: 300,
    maxCount: 3,
    zone: 'all',
    temperament: 'semi-aggressive',
    schooling: false,
    difficulty: 'advanced',
    compatibleTypes: ['marine'],
    incompatibleWith: ['tang'],
    description: 'Яркий морской хирург. Требует большого объёма.',
    careLevel: 'Сложный',
  },
];

// Итоговый список: ручные + сконвертированные из внешних JSON (без дубликатов по id)
const ALL_FISH: Fish[] = [
  ...BASE_FISH_DATABASE,
  ...CONVERTED_FISH_DATABASE.filter(
    (fish) => !BASE_FISH_DATABASE.some((baseFish) => baseFish.id === fish.id)
  ),
];

// Автоматически обновляем матрицу совместимости на основе тегов
export const FISH_DATABASE: Fish[] = updateFishIncompatibility(ALL_FISH);

export const getFishByType = (type: AquariumType): Fish[] => {
  if (type === 'planted') {
    return FISH_DATABASE.filter(
      (fish) => fish.compatibleTypes.includes('freshwater') || fish.compatibleTypes.includes('planted')
    );
  }

  if (type === 'pseudomarine') {
    return FISH_DATABASE.filter(
      (fish) => fish.compatibleTypes.includes('marine') || fish.compatibleTypes.includes('pseudomarine')
    );
  }

  return FISH_DATABASE.filter((fish) => fish.compatibleTypes.includes(type));
};

export const getFishById = (id: string): Fish | undefined => {
  return FISH_DATABASE.find((fish) => fish.id === id);
};
